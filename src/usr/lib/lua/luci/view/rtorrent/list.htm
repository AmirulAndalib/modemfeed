<%-
local rowcnt = 1
function rowstyle()
	rowcnt = rowcnt + 1
	return (rowcnt % 2) + 1
end

function ucfirst(s)
	return s:gsub("^%l", string.upper)
end

-%>

<fieldset class="cbi-section" id="cbi-<%=self.config%>-<%=self.sectiontype%>">
	<div class="cbi-section-node">
		<ul class="cbi-tabmenu">
			<%- for i, k in ipairs(self.pages) do -%>
				<%- if k.name ~= "protected" then if self.page == k.name then -%>
					<li class="cbi-tab"><a href="<%=k.link%>"><%=ucfirst(k.name)%></a></li>
				<%- else -%>
					<li class="cbi-tab-disabled"><a href="<%=k.link%>"><%=ucfirst(k.name)%></a></li>
				<%- end end -%>
			<%- end -%>
		</ul>
		<table class="cbi-section-table">
			<tr class="cbi-section-table-titles">
			<%- for i, k in pairs(self.children) do -%>
				<th class="cbi-section-table-cell"><%=k.title%></th>
			<%- end -%>
			</tr>

			<%- for i, k in ipairs(self:cfgsections()) do
				section = k
				scope = { valueheader = "cbi/cell_valueheader", valuefooter = "cbi/cell_valuefooter" }
			-%>
				<tr class="cbi-section-table-row cbi-rowstyle-<%=rowstyle()%>" id="cbi-<%=self.config%>-<%=section%>">
				<%- for k, node in ipairs(self.children) do
					if not node.optional then
						node:render(section, scope or {})
					end
				end -%>
				</tr>
			<%- end -%>
		</table>
	</div>
</fieldset>
